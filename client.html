<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ghadeer Logistics | حساب العميل</title>
  <link rel="stylesheet" href="assets/css/theme.css">
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <div class="brand-mark">GL</div>
      <h1>Ghadeer Logistics</h1>
    </div>
    <nav class="nav-links">
      <a class="nav-link" href="Home.html">الرئيسية</a>
      <a class="nav-link" href="about.html">عن الشركة</a>
      <a class="nav-link" href="dashboard.html">لوحة التحكم</a>
      <a class="nav-link active" href="accounts.html">الحسابات</a>
      <a class="nav-link" href="track.html">تتبع الشحنات</a>
      <a class="nav-link" href="Reportal.html">التقارير</a>
      <a class="nav-link" href="contact.html">اتصل بنا</a>
      <a class="nav-link" href="index.html">تسجيل الدخول</a>
    </nav>
  </header>

  <main class="page-shell">
    <section class="glass-card hero-card">
      <h2 class="page-title" id="title">حساب العميل</h2>
      <p class="lead">إدارة الفواتير والسجلات المالية الخاصة بالعميل المحدد. يتم تحديث الأرقام فورًا بعد كل تعديل.</p>
      <div class="chip-row">
        <span class="chip">📑 فواتير: <span id="invoiceCount">0</span></span>
        <span class="chip">💰 إجمالي مستحق: <span id="totalValue">0</span> د.ع</span>
      </div>
      <div class="actions-row">
        <a class="button ghost" href="accounts.html">⬅️ الرجوع إلى الحسابات</a>
      </div>
    </section>

    <section class="glass-card">
      <div class="section-heading">
        <div>
          <h2>إضافة فاتورة</h2>
          <p>أدخل بيانات الفاتورة الجديدة أو عدّل فاتورة حالية.</p>
        </div>
      </div>
      <form id="invoiceForm" class="form-grid inline">
        <div>
          <label for="date">التاريخ</label>
          <input type="date" id="date" required>
        </div>
        <div>
          <label for="driver">اسم السائق</label>
          <input type="text" id="driver" placeholder="مثال: أحمد رشيد" required>
        </div>
        <div>
          <label for="cargo">الحمولة</label>
          <input type="text" id="cargo" placeholder="نوع البضاعة" required>
        </div>
        <div>
          <label for="price">السعر</label>
          <input type="number" id="price" placeholder="المبلغ بالدينار" required>
        </div>
        <button class="button primary" type="submit" id="submitBtn">➕ إضافة فاتورة</button>
      </form>
    </section>

    <section class="glass-card table-card">
      <div class="table-header">
        <div class="section-heading">
          <div>
            <h2>سجل الفواتير</h2>
            <p>يمكنك تعديل أو حذف أي فاتورة من القائمة التالية.</p>
          </div>
        </div>
      </div>
      <div class="table-scroll">
        <table class="data-table">
          <thead>
            <tr>
              <th>📅 التاريخ</th>
              <th>🚚 السائق</th>
              <th>📦 الحمولة</th>
              <th>💰 السعر</th>
              <th>⚙️ الخيارات</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
          <tfoot>
            <tr>
              <td colspan="5">
                <div class="chip">إجمالي الحساب: <span id="totalFooter">0</span> د.ع</div>
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </section>

    <p class="footer-note">يتم حفظ البيانات في المتصفح المحلي. تأكد من تصديرها عند الحاجة.</p>
  </main>

  <script>
    const params = new URLSearchParams(location.search);
    const client = params.get('name') || 'عميل غير معروف';
    const title = document.getElementById('title');
    title.textContent = 'حساب العميل: ' + client;

    let accounts = JSON.parse(localStorage.getItem('accounts')) || {};
    if (!accounts[client]) {
      accounts[client] = [];
    }
    let list = accounts[client];
    let editIndex = null;

    function render() {
      const tbody = document.getElementById('rows');
      const invoiceCount = document.getElementById('invoiceCount');
      const totalBadge = document.getElementById('totalValue');
      const totalFooter = document.getElementById('totalFooter');

      tbody.innerHTML = '';
      let total = 0;

      list.forEach((entry, index) => {
        const amount = Number(entry.price) || 0;
        total += amount;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${entry.date || '-'}</td>
          <td>${entry.driver || '-'}</td>
          <td>${entry.cargo || '-'}</td>
          <td>${amount.toLocaleString('en-US')}</td>
          <td>
            <div class="action-buttons">
              <button class="action-button edit" onclick="editInvoice(${index})">✏️ تعديل</button>
              <button class="action-button delete" onclick="deleteInvoice(${index})">🗑️ حذف</button>
            </div>
          </td>`;
        tbody.appendChild(tr);
      });

      invoiceCount.textContent = list.length;
      totalBadge.textContent = total.toLocaleString('en-US');
      totalFooter.textContent = total.toLocaleString('en-US');
    }

    document.getElementById('invoiceForm').addEventListener('submit', (event) => {
      event.preventDefault();
      const entry = {
        date: document.getElementById('date').value,
        driver: document.getElementById('driver').value,
        cargo: document.getElementById('cargo').value,
        price: document.getElementById('price').value
      };

      if (editIndex !== null) {
        list[editIndex] = entry;
        editIndex = null;
        document.getElementById('submitBtn').textContent = '➕ إضافة فاتورة';
      } else {
        list.push(entry);
      }

      accounts[client] = list;
      localStorage.setItem('accounts', JSON.stringify(accounts));
      render();
      event.target.reset();
    });

    function editInvoice(index) {
      const entry = list[index];
      document.getElementById('date').value = entry.date;
      document.getElementById('driver').value = entry.driver;
      document.getElementById('cargo').value = entry.cargo;
      document.getElementById('price').value = entry.price;
      document.getElementById('submitBtn').textContent = '💾 حفظ التعديل';
      editIndex = index;
    }

    function deleteInvoice(index) {
      if (confirm('هل تريد حذف هذه الفاتورة؟')) {
        list.splice(index, 1);
        accounts[client] = list;
        localStorage.setItem('accounts', JSON.stringify(accounts));
        render();
      }
    }

    render();
  </script>
</body>
</html>
