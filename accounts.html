<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª - Ghadeer Logistics</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --primary:#cc3300;
      --primary-dark:#a32900;
      --accent:#ffd166;
      --bg:#f2f4f8;
      --card:#ffffff;
      --text:#1a1d23;
      --muted:#6b7280;
      --radius:18px;
      font-family:'Cairo',sans-serif;
    }
    * { box-sizing:border-box; }
    body {
      margin:0;
      min-height:100vh;
      background:linear-gradient(135deg,#fef2f2 0%,#f2f4f8 55%,#eef2ff 100%);
      color:var(--text);
    }
    .page {
      max-width:1200px;
      margin:0 auto;
      padding:32px 20px 60px;
    }
    .back-container {
      text-align:right;
      margin-bottom:20px;
    }
    .back-button {
      display:inline-flex;
      align-items:center;
      gap:6px;
      background:#003366;
      color:#fff;
      padding:10px 18px;
      border-radius:999px;
      text-decoration:none;
      font-weight:600;
      box-shadow:0 6px 16px rgba(0,0,0,0.18);
      transition:transform .2s ease, box-shadow .2s ease, background .2s ease;
    }
    .back-button:hover {
      background:#005599;
      transform:translateY(-2px);
      box-shadow:0 8px 20px rgba(0,0,0,0.22);
    }
    header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:20px;
      margin-bottom:32px;
      flex-wrap:wrap;
    }
    .brand {
      display:flex;
      align-items:center;
      gap:16px;
    }
    .brand img {
      width:58px;
      height:58px;
      border-radius:50%;
      object-fit:cover;
      box-shadow:0 8px 16px rgba(204,51,0,0.18);
    }
    h1 {
      font-size:28px;
      margin:0;
      color:var(--primary);
    }
@@ -261,79 +283,80 @@
      color:var(--primary);
    }
    .top-clients {
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .top-clients li {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:14px 16px;
      background:#fff6f2;
      border-radius:14px;
      font-size:14px;
    }
    .top-clients span { color:var(--muted); }
    .notes textarea { min-height:120px; }
  </style>
</head>
<body>
  <div class="page">
    <div class="back-container"><a href="#" class="back-button" onclick="history.back(); return false;">ğŸ”™ Ø±Ø¬ÙˆØ¹</a></div>
    <header>
      <div class="brand">
        <img src="your-logo.jpeg" alt="Ghadeer Logistics logo">
        <div>
          <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h1>
          <p>Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø§Ù„ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù„Ø¹Ù…Ù„Ø§Ø¡ Ghadeer Logistics</p>
        </div>
      </div>
      <div class="quick-actions">
        <button class="btn btn-secondary" type="button" id="seedData">ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
        <button class="btn btn-primary" type="button" onclick="exportCSV()">ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± CSV</button>
      </div>
    </header>

    <section class="summary-grid">
      <article class="summary-card">
        <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</h3>
        <strong id="metricClients">0</strong>
        <span>ğŸ‘¥ Ø¹Ù…Ù„Ø§Ø¡ Ù…ÙˆØ«Ù‚ÙˆÙ†</span>
      </article>
      <article class="summary-card">
        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>
        <strong id="metricInvoices">0</strong>
        <span>ğŸ“‘ ÙÙˆØ§ØªÙŠØ± Ù…Ø³Ø¬Ù„Ø©</span>
      </article>
      <article class="summary-card">
        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº</h3>
        <strong id="metricAmount">0</strong>
        <span>ğŸ’µ Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</span>
      </article>
      <article class="summary-card">
        <h3>Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
        <strong id="metricAverage">0</strong>
        <span>âš–ï¸ Ù…Ø¤Ø´Ø± Ù…ØªÙˆØ³Ø·</span>
      </article>
    </section>

    <div class="workspace">
      <section class="panel">
        <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ±</h2>
        <div class="filters">
          <input type="text" id="search" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„...">
          <select id="sort">
            <option value="">â†•ï¸ ØªØ±ØªÙŠØ¨ Ø§ÙØªØ±Ø§Ø¶ÙŠ</option>
            <option value="nameAsc">ğŸ”¤ Ø§Ù„Ø§Ø³Ù… (Ø£-ÙŠ)</option>
            <option value="nameDesc">ğŸ”¤ Ø§Ù„Ø§Ø³Ù… (ÙŠ-Ø£)</option>
            <option value="invoices">ğŸ“‘ Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</option>
            <option value="total">ğŸ’° Ø­Ø³Ø¨ Ø£Ø¹Ù„Ù‰ Ù…Ø¨Ù„Øº</option>
          </select>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
        <h3>Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
        <strong id="metricAverage">0</strong>
        <span>âš–ï¸ Ù…Ø¤Ø´Ø± Ù…ØªÙˆØ³Ø·</span>
      </article>
    </section>

    <div class="workspace">
      <section class="panel">
        <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ±</h2>
        <div class="filters">
          <input type="text" id="search" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„...">
          <select id="sort">
            <option value="">â†•ï¸ ØªØ±ØªÙŠØ¨ Ø§ÙØªØ±Ø§Ø¶ÙŠ</option>
            <option value="nameAsc">ğŸ”¤ Ø§Ù„Ø§Ø³Ù… (Ø£-ÙŠ)</option>
            <option value="nameDesc">ğŸ”¤ Ø§Ù„Ø§Ø³Ù… (ÙŠ-Ø£)</option>
            <option value="invoices">ğŸ“‘ Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</option>
            <option value="total">ğŸ’° Ø­Ø³Ø¨ Ø£Ø¹Ù„Ù‰ Ù…Ø¨Ù„Øº</option>
          </select>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                <th>Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</th>
                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº</th>
                <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                <th>Ø®ÙŠØ§Ø±Ø§Øª</th>
              </tr>
            </thead>
            <tbody id="clients"></tbody>
          </table>
          <div class="empty-state" id="emptyState" hidden>
            Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯. Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„Ø§Ø¡ Ø£Ùˆ Ø­Ù…Ù‘Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©.
          </div>
        </div>
      </section>

      <aside class="aside">
        <section class="panel">
          <h2>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h2>
          <form id="clientForm">
            <label for="clientName">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
            <input type="text" id="clientName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" required>

            <label for="clientNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
            <textarea id="clientNotes" placeholder="Ø£ÙƒØªØ¨ Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„ØªØ¹Ø§Ù…Ù„"></textarea>

            <button class="btn btn-primary" type="submit">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
          </form>
        </section>

        <section class="list-card">
          <h3>Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø­Ø³Ø¨ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯</h3>
          <ul class="top-clients" id="topClients">
            <li>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯<span>--</span></li>
          </ul>
        </section>

        <section class="list-card notes">
          <h3>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙØ±ÙŠÙ‚</h3>
          <textarea placeholder="Ø¯ÙˆÙ‘Ù† Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø§Ù„Ø³Ø±ÙŠØ¹Ø© Ø­ÙˆÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª..." id="teamNotes"></textarea>
        </section>
      </aside>
    </div>
  </div>

  <script>
    let accounts = JSON.parse(localStorage.getItem("accounts")) || {};
    const notesKey = "accounts-notes";
    const clientNotesKey = "client-notes-map";
    let clientNotesMap = JSON.parse(localStorage.getItem(clientNotesKey)) || {};

    const searchInput = document.getElementById("search");
    const sortSelect = document.getElementById("sort");
    const clientsBody = document.getElementById("clients");
    const emptyState = document.getElementById("emptyState");
    const topClientsList = document.getElementById("topClients");
    const teamNotes = document.getElementById("teamNotes");

    teamNotes.value = localStorage.getItem(notesKey) || "";
    teamNotes.addEventListener("input", () => {
      localStorage.setItem(notesKey, teamNotes.value);
    });

    document.getElementById("clientForm").addEventListener("submit", addClient);
    searchInput.addEventListener("input", render);
    sortSelect.addEventListener("change", render);
    document.getElementById("seedData").addEventListener("click", seedDemoData);

    function render(){
      clientsBody.innerHTML = "";
      const query = searchInput.value.trim();
      let clients = Object.keys(accounts);

      if(query){
        clients = clients.filter(name => name.includes(query));
      }

      const sortValue = sortSelect.value;
      clients.sort((a,b) => {
        if(sortValue === "nameAsc") return a.localeCompare(b);
        if(sortValue === "nameDesc") return b.localeCompare(a);
        if(sortValue === "invoices") return accounts[b].length - accounts[a].length;
        if(sortValue === "total"){
          const totalA = totalAmountFor(a);
          const totalB = totalAmountFor(b);
          return totalB - totalA;
        }
        return 0;
      });

      if(clients.length === 0){
        emptyState.hidden = false;
      } else {
        emptyState.hidden = true;
      }

      for(const client of clients){
        const invoices = accounts[client];
        const total = totalAmountFor(client);
        const note = clientNotesMap[client];
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><strong>${client}</strong></td>
          <td><span class="tag">${invoices.length}</span></td>
          <td>${formatCurrency(total)}</td>
          <td>${note ? `<span class="note-pill" title="${note}">${notePreview(note)}</span>` : "--"}</td>
          <td>
            <div class="actions">
              <button class="action-btn view" onclick="viewClient('${client}')">Ø¹Ø±Ø¶</button>
              <button class="action-btn edit" onclick="editClient('${client}')">ØªØ¹Ø¯ÙŠÙ„</button>
              <button class="action-btn delete" onclick="deleteClient('${client}')">Ø­Ø°Ù</button>
            </div>
          </td>`;
        clientsBody.appendChild(tr);
      }

      updateMetrics();
      renderTopClients();
    }

    function addClient(event){
      event.preventDefault();
      const name = document.getElementById("clientName").value.trim();
      if(!name) return;
      const noteValue = document.getElementById("clientNotes").value.trim();
      if(!accounts[name]){
        accounts[name] = [];
      }
      if(noteValue){
        clientNotesMap[name] = noteValue;
      } else if(clientNotesMap[name]){
        delete clientNotesMap[name];
      }
      localStorage.setItem("accounts", JSON.stringify(accounts));
      localStorage.setItem(clientNotesKey, JSON.stringify(clientNotesMap));
      event.target.reset();
      render();
    }

    function viewClient(name){
      window.location.href = "client.html?name=" + encodeURIComponent(name);
    }

    function editClient(oldName){
      const newName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ù…ÙŠÙ„:", oldName);
      if(newName && newName !== oldName){
        accounts[newName] = accounts[oldName];
        delete accounts[oldName];
        if(clientNotesMap[oldName]){
          clientNotesMap[newName] = clientNotesMap[oldName];
          delete clientNotesMap[oldName];
        }
        localStorage.setItem("accounts", JSON.stringify(accounts));
        localStorage.setItem(clientNotesKey, JSON.stringify(clientNotesMap));
        render();
      }
    }

    function deleteClient(name){
      if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ " + name + " ÙˆØ¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ØŸ")){
        delete accounts[name];
        if(clientNotesMap[name]){
          delete clientNotesMap[name];
          localStorage.setItem(clientNotesKey, JSON.stringify(clientNotesMap));
        }
        localStorage.setItem("accounts", JSON.stringify(accounts));
        render();
      }
    }

    function exportCSV(){
      const rows = [["Ø§Ù„Ø¹Ù…ÙŠÙ„","Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº","Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]];
      for(const client in accounts){
        const invoices = accounts[client];
        const total = invoices.reduce((sum, invoice) => sum + Number(invoice.price || 0), 0);
        const note = clientNotesMap[client] ? clientNotesMap[client].replace(/\n/g, " ") : "";
        rows.push([client, invoices.length, total, note]);
      }
      const csvContent = rows.map(row => row.join(",")).join("\n");
      const blob = new Blob([csvContent], { type:"text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = "accounts-report.csv";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    function totalAmountFor(client){
      return accounts[client].reduce((sum, invoice) => sum + Number(invoice.price || 0), 0);
    }

    function formatCurrency(value){
      return Number(value || 0).toLocaleString("ar-SA", { style:"currency", currency:"SAR" });
    }

    function updateMetrics(){
      const clientCount = Object.keys(accounts).length;
      let invoiceCount = 0;
      let totalAmount = 0;
      for(const client in accounts){
        const invoices = accounts[client];
        invoiceCount += invoices.length;
        totalAmount += invoices.reduce((sum, invoice) => sum + Number(invoice.price || 0), 0);
      }
      const average = invoiceCount ? totalAmount / invoiceCount : 0;
      document.getElementById("metricClients").textContent = clientCount.toLocaleString("ar-SA");
      document.getElementById("metricInvoices").textContent = invoiceCount.toLocaleString("ar-SA");
      document.getElementById("metricAmount").textContent = formatCurrency(totalAmount);
      document.getElementById("metricAverage").textContent = formatCurrency(average);
    }

    function renderTopClients(){
      const entries = Object.entries(accounts).map(([name, invoices]) => {
        return { name, total: invoices.reduce((sum, invoice) => sum + Number(invoice.price || 0), 0) };
      }).filter(item => item.total > 0);
      entries.sort((a,b) => b.total - a.total);
      topClientsList.innerHTML = "";
      if(entries.length === 0){
        const li = document.createElement("li");
        li.innerHTML = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯<span>--</span>";
        topClientsList.appendChild(li);
        return;
      }
      for(const item of entries.slice(0,5)){
        const li = document.createElement("li");
        li.innerHTML = `<strong>${item.name}</strong><span>${formatCurrency(item.total)}</span>`;
        topClientsList.appendChild(li);
      }
    }

    function seedDemoData(){
      accounts = {
        "Ø´Ø±ÙƒØ© Ø´Ù…Ø§Ù„ Ø§Ù„Ø¨Ø­Ø±": [
          { invoice:"INV-001", price: 4200 },
          { invoice:"INV-014", price: 3600 },
          { invoice:"INV-028", price: 6900 }
        ],
        "Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡ Ø§Ù„Ø­Ø¯ÙŠØ«": [
          { invoice:"INV-004", price: 1800 },
          { invoice:"INV-051", price: 2400 }
        ],
        "ØªØ­Ø§Ù„Ù Ø§Ù„Ø®Ù„ÙŠØ¬ Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠ": [
          { invoice:"INV-019", price: 9500 },
          { invoice:"INV-121", price: 7200 },
          { invoice:"INV-177", price: 5300 },
          { invoice:"INV-190", price: 2800 }
        ],
        "Ø­Ù„ÙˆÙ„ Ø§Ù„Ù†ÙˆØ± Ù„Ù„Ù…Ù„Ø§Ø­Ø©": [
          { invoice:"INV-031", price: 3100 }
        ],
        "Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ": [
          { invoice:"INV-211", price: 8700 },
          { invoice:"INV-212", price: 6500 }
        ]
      };
      clientNotesMap = {
        "Ø´Ø±ÙƒØ© Ø´Ù…Ø§Ù„ Ø§Ù„Ø¨Ø­Ø±": "Ø¹Ù…ÙŠÙ„ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ Ù…Ø¹ Ø´Ø­Ù†Ø§Øª Ø´Ù‡Ø±ÙŠØ© Ø«Ø§Ø¨ØªØ©.",
        "Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡ Ø§Ù„Ø­Ø¯ÙŠØ«": "ÙŠØ­ØªØ§Ø¬ Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© ØªÙØµÙŠÙ„ÙŠØ©.",
        "ØªØ­Ø§Ù„Ù Ø§Ù„Ø®Ù„ÙŠØ¬ Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠ": "Ø£ÙƒØ¨Ø± Ø¹Ù…ÙŠÙ„ Ù…Ù† Ù†Ø§Ø­ÙŠØ© Ø­Ø¬Ù… Ø§Ù„Ø´Ø­Ù†Ø§Øª.",
        "Ø­Ù„ÙˆÙ„ Ø§Ù„Ù†ÙˆØ± Ù„Ù„Ù…Ù„Ø§Ø­Ø©": "Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ Ù‚ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.",
        "Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ": "ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¨Ø¢Ù„ÙŠØ© ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ ÙƒÙ„ 10 Ø£ÙŠØ§Ù…."
      };
      localStorage.setItem("accounts", JSON.stringify(accounts));
      localStorage.setItem(clientNotesKey, JSON.stringify(clientNotesMap));
      render();
    }

    function notePreview(note){
      if(note.length <= 22) return note;
      return note.slice(0, 22) + "...";
    }

    render();
  </script>
</body>
</html>
