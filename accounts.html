<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª - Ghadeer Logistics</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --primary:#cc3300;
      --primary-dark:#a32900;
      --accent:#ffd166;
      --bg:#f2f4f8;
      --card:#ffffff;
      --text:#1a1d23;
      --muted:#6b7280;
      --radius:18px;
      font-family:'Cairo',sans-serif;
    }
    * { box-sizing:border-box; }
    body {
      margin:0;
      min-height:100vh;
      background:linear-gradient(135deg,#fef2f2 0%,#f2f4f8 55%,#eef2ff 100%);
      color:var(--text);
    }
    .page {
      max-width:1200px;
      margin:0 auto;
      padding:clamp(24px,5vw,56px) clamp(16px,6vw,44px) 72px;
    }
    .back-container {
      text-align:right;
      margin-bottom:20px;
    }
    .back-button {
      display:inline-flex;
      align-items:center;
      gap:6px;
      background:#003366;
      color:#fff;
      padding:10px 18px;
      border-radius:999px;
      text-decoration:none;
      font-weight:600;
      box-shadow:0 6px 16px rgba(0,0,0,0.18);
      transition:transform .2s ease, box-shadow .2s ease, background .2s ease;
    }
    .back-button:hover {
      background:#005599;
      transform:translateY(-2px);
      box-shadow:0 8px 20px rgba(0,0,0,0.22);
    }
    header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:20px;
      margin-bottom:32px;
      flex-wrap:wrap;
    }
    header p { margin:4px 0 0; color:var(--muted); }
    .brand {
      display:flex;
      align-items:center;
      gap:16px;
    }
    .brand img {
      width:58px;
      height:58px;
      border-radius:50%;
      object-fit:cover;
      box-shadow:0 8px 16px rgba(204,51,0,0.18);
    }
    h1 {
      font-size:28px;
      margin:0;
      color:var(--primary);
    }
    .quick-actions { display:flex; gap:12px; flex-wrap:wrap; }
    .btn {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      background:var(--primary);
      color:#fff;
      padding:10px 20px;
      border:none;
      border-radius:999px;
      font-weight:700;
      cursor:pointer;
      transition:background .2s ease, transform .2s ease, box-shadow .2s ease;
      box-shadow:0 6px 16px rgba(204,51,0,0.18);
    }
    .btn:hover {
      background:var(--primary-dark);
      transform:translateY(-2px);
      box-shadow:0 10px 20px rgba(204,51,0,0.22);
    }
    .summary-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:18px;
      margin-bottom:32px;
    }
    .summary-card {
      background:var(--card);
      border-radius:var(--radius);
      padding:22px 24px;
      box-shadow:0 12px 24px rgba(0,0,0,0.08);
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .summary-card strong {
      font-size:30px;
      color:var(--primary);
    }
    .summary-card span {
      color:var(--muted);
      font-weight:600;
      font-size:14px;
    }
    .workspace {
      display:grid;
      grid-template-columns:minmax(0,2fr) minmax(0,1fr);
      gap:24px;
      align-items:start;
    }
    .panel {
      background:var(--card);
      border-radius:var(--radius);
      padding:24px;
      box-shadow:0 10px 24px rgba(0,0,0,0.08);
    }
    .panel h2 {
      margin-top:0;
      margin-bottom:16px;
      color:var(--primary);
    }
    .filters {
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      margin-bottom:16px;
    }
    .filters input,
    .filters select {
      flex:1 1 220px;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid #d6dae2;
      font-family:inherit;
      font-size:15px;
      background:#f8faff;
    }
    .table-wrapper {
      border-radius:var(--radius);
      border:1px solid #edf1f9;
      overflow-x:auto;
      background:#fff;
    }
    table {
      width:100%;
      border-collapse:collapse;
      min-width:600px;
    }
    th,td {
      padding:14px 16px;
      border-bottom:1px solid #edf1f9;
      text-align:center;
      font-size:15px;
    }
    th:first-child,
    td:first-child,
    td:nth-child(4) {
      text-align:right;
    }
    th {
      background:#f9fafc;
      color:var(--muted);
      font-weight:700;
    }
    tbody tr:hover { background:#fff6f2; }
    .tag {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:6px 12px;
      border-radius:999px;
      background:#f2f4ff;
      color:var(--primary);
      font-weight:700;
      min-width:48px;
    }
    .note-pill {
      display:inline-block;
      background:#fff0db;
      color:var(--primary-dark);
      padding:6px 12px;
      border-radius:999px;
      font-size:13px;
      max-width:180px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .actions {
      display:flex;
      justify-content:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .action-btn {
      border:none;
      border-radius:10px;
      padding:8px 14px;
      font-weight:600;
      cursor:pointer;
      transition:transform .2s ease, box-shadow .2s ease;
    }
    .action-btn.view { background:#e3f2fd; color:#0d47a1; }
    .action-btn.edit { background:#fff0db; color:#7f4600; }
    .action-btn.delete { background:#ffe5e9; color:#b71c1c; }
    .action-btn:hover { transform:translateY(-2px); box-shadow:0 6px 12px rgba(0,0,0,0.12); }
    .aside {
      display:flex;
      flex-direction:column;
      gap:18px;
    }
    .list-card {
      background:var(--card);
      border-radius:var(--radius);
      padding:20px 22px;
      box-shadow:0 8px 20px rgba(0,0,0,0.06);
    }
    .list-card h3 { margin-top:0; margin-bottom:12px; color:var(--primary); }
    .top-clients {
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .top-clients li {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:12px 14px;
      background:#fff6f2;
      border-radius:14px;
      font-size:14px;
    }
    .top-clients span { color:var(--muted); }
    textarea {
      width:100%;
      border-radius:14px;
      border:1px solid #d6dae2;
      padding:12px;
      font-family:inherit;
      font-size:15px;
      resize:vertical;
      min-height:120px;
      background:#f9fbff;
    }
    .empty-state {
      padding:20px;
      text-align:center;
      color:var(--muted);
    }
    @media (max-width: 992px) {
      .workspace {
        grid-template-columns:1fr;
      }
      .quick-actions { width:100%; justify-content:flex-start; }
    }
    @media (max-width: 640px) {
      header {
        align-items:flex-start;
      }
      h1 { font-size:24px; }
      .summary-card strong { font-size:26px; }
      .filters input,
      .filters select {
        flex:1 1 100%;
      }
      table {
        min-width:520px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="back-container"><a href="#" class="back-button" onclick="history.back(); return false;">ğŸ”™ Ø±Ø¬ÙˆØ¹</a></div>
    <header>
      <div class="brand">
        <img src="your-logo.jpeg" alt="Ghadeer Logistics logo">
        <div>
          <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h1>
          <p>Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø§Ù„ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù„Ø¹Ù…Ù„Ø§Ø¡ Ghadeer Logistics</p>
        </div>
      </div>
      <div class="quick-actions">
        <button class="btn btn-primary" type="button" onclick="exportCSV()">ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± CSV</button>
      </div>
    </header>

    <section class="summary-grid">
      <article class="summary-card">
        <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</h3>
        <strong id="metricClients">0</strong>
        <span>ğŸ‘¥ Ø¹Ù…Ù„Ø§Ø¡ Ù…ÙˆØ«Ù‚ÙˆÙ†</span>
      </article>
      <article class="summary-card">
        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>
        <strong id="metricInvoices">0</strong>
        <span>ğŸ“‘ ÙÙˆØ§ØªÙŠØ± Ù…Ø³Ø¬Ù„Ø©</span>
      </article>
      <article class="summary-card">
        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº</h3>
        <strong id="metricAmount">0</strong>
        <span>ğŸ’µ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</span>
      </article>
      <article class="summary-card">
        <h3>Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
        <strong id="metricAverage">0</strong>
        <span>âš–ï¸ Ù…Ø¤Ø´Ø± Ù…ØªÙˆØ³Ø·</span>
      </article>
    </section>

    <div class="workspace">
      <section class="panel">
        <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ±</h2>
        <div class="filters">
          <input type="text" id="search" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„...">
          <select id="sort">
            <option value="">â†•ï¸ ØªØ±ØªÙŠØ¨ Ø§ÙØªØ±Ø§Ø¶ÙŠ</option>
            <option value="nameAsc">ğŸ”¤ Ø§Ù„Ø§Ø³Ù… (Ø£-ÙŠ)</option>
            <option value="nameDesc">ğŸ”¤ Ø§Ù„Ø§Ø³Ù… (ÙŠ-Ø£)</option>
            <option value="invoices">ğŸ“‘ Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</option>
            <option value="total">ğŸ’° Ø­Ø³Ø¨ Ø£Ø¹Ù„Ù‰ Ù…Ø¨Ù„Øº</option>
          </select>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
        <h3>Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
        <strong id="metricAverage">0</strong>
        <span>âš–ï¸ Ù…Ø¤Ø´Ø± Ù…ØªÙˆØ³Ø·</span>
      </article>
    </section>

    <div class="workspace">
      <section class="panel">
        <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ±</h2>
        <div class="filters">
          <input type="text" id="search" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„...">
          <select id="sort">
            <option value="">â†•ï¸ ØªØ±ØªÙŠØ¨ Ø§ÙØªØ±Ø§Ø¶ÙŠ</option>
            <option value="nameAsc">ğŸ”¤ Ø§Ù„Ø§Ø³Ù… (Ø£-ÙŠ)</option>
            <option value="nameDesc">ğŸ”¤ Ø§Ù„Ø§Ø³Ù… (ÙŠ-Ø£)</option>
            <option value="invoices">ğŸ“‘ Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</option>
            <option value="total">ğŸ’° Ø­Ø³Ø¨ Ø£Ø¹Ù„Ù‰ Ù…Ø¨Ù„Øº</option>
          </select>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                <th>Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</th>
                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº (USD)</th>
                <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                <th>Ø®ÙŠØ§Ø±Ø§Øª</th>
              </tr>
            </thead>
            <tbody id="clients"></tbody>
          </table>
          <div class="empty-state" id="emptyState" hidden>
            Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯. Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„Ø§Ø¡ Ø¬Ø¯Ø¯ Ù„Ø¹Ø±Ø¶ Ø³Ø¬Ù„Ø§ØªÙ‡Ù… Ù‡Ù†Ø§.
          </div>
        </div>
      </section>

      <aside class="aside">
        <section class="panel">
          <h2>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h2>
          <form id="clientForm">
            <label for="clientName">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
            <input type="text" id="clientName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" required>

            <label for="clientNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
            <textarea id="clientNotes" placeholder="Ø£ÙƒØªØ¨ Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„ØªØ¹Ø§Ù…Ù„"></textarea>

            <button class="btn btn-primary" type="submit">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
          </form>
        </section>

        <section class="list-card">
          <h3>Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø­Ø³Ø¨ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯</h3>
          <ul class="top-clients" id="topClients">
            <li>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯<span>--</span></li>
          </ul>
        </section>

        <section class="list-card notes">
          <h3>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙØ±ÙŠÙ‚</h3>
          <textarea placeholder="Ø¯ÙˆÙ‘Ù† Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø§Ù„Ø³Ø±ÙŠØ¹Ø© Ø­ÙˆÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª..." id="teamNotes"></textarea>
        </section>
      </aside>
    </div>
  </div>

  <script>
    let accounts = JSON.parse(localStorage.getItem("accounts")) || {};
    const notesKey = "accounts-notes";
    const clientNotesKey = "client-notes-map";
    let clientNotesMap = JSON.parse(localStorage.getItem(clientNotesKey)) || {};
    const numberLocale = "ar-IQ";
    const numberFormatter = new Intl.NumberFormat(numberLocale);
    const currencyFormatter = new Intl.NumberFormat(numberLocale, { style: "currency", currency: "USD" });

    const searchInput = document.getElementById("search");
    const sortSelect = document.getElementById("sort");
    const clientsBody = document.getElementById("clients");
    const emptyState = document.getElementById("emptyState");
    const topClientsList = document.getElementById("topClients");
    const teamNotes = document.getElementById("teamNotes");

    teamNotes.value = localStorage.getItem(notesKey) || "";
    teamNotes.addEventListener("input", () => {
      localStorage.setItem(notesKey, teamNotes.value);
    });

    document.getElementById("clientForm").addEventListener("submit", addClient);
    searchInput.addEventListener("input", render);
    sortSelect.addEventListener("change", render);

    function render(){
      clientsBody.innerHTML = "";
      const query = searchInput.value.trim();
      let clients = Object.keys(accounts);

      if(query){
        clients = clients.filter(name => name.includes(query));
      }

      const sortValue = sortSelect.value;
      clients.sort((a,b) => {
        if(sortValue === "nameAsc") return a.localeCompare(b);
        if(sortValue === "nameDesc") return b.localeCompare(a);
        if(sortValue === "invoices") return accounts[b].length - accounts[a].length;
        if(sortValue === "total"){
          const totalA = totalAmountFor(a);
          const totalB = totalAmountFor(b);
          return totalB - totalA;
        }
        return 0;
      });

      if(clients.length === 0){
        emptyState.hidden = false;
      } else {
        emptyState.hidden = true;
      }

        for(const client of clients){
          const invoices = accounts[client];
          const total = totalAmountFor(client);
          const note = clientNotesMap[client];
          const tr = document.createElement("tr");

          const nameCell = document.createElement("td");
          const strong = document.createElement("strong");
          strong.textContent = client;
          nameCell.appendChild(strong);
          tr.appendChild(nameCell);

          const invoiceCell = document.createElement("td");
          const invoiceTag = document.createElement("span");
          invoiceTag.className = "tag";
          invoiceTag.textContent = numberFormatter.format(invoices.length);
          invoiceCell.appendChild(invoiceTag);
          tr.appendChild(invoiceCell);

          const totalCell = document.createElement("td");
          totalCell.textContent = formatCurrency(total);
          tr.appendChild(totalCell);

          const noteCell = document.createElement("td");
          if(note){
            const notePill = document.createElement("span");
            notePill.className = "note-pill";
            notePill.textContent = notePreview(note);
            notePill.title = note;
            noteCell.appendChild(notePill);
          } else {
            noteCell.textContent = "--";
          }
          tr.appendChild(noteCell);

          const actionsCell = document.createElement("td");
          const actionsWrapper = document.createElement("div");
          actionsWrapper.className = "actions";

          const viewButton = document.createElement("button");
          viewButton.type = "button";
          viewButton.className = "action-btn view";
          viewButton.textContent = "Ø¹Ø±Ø¶";
          viewButton.addEventListener("click", () => viewClient(client));
          actionsWrapper.appendChild(viewButton);

          const editButton = document.createElement("button");
          editButton.type = "button";
          editButton.className = "action-btn edit";
          editButton.textContent = "ØªØ¹Ø¯ÙŠÙ„";
          editButton.addEventListener("click", () => editClient(client));
          actionsWrapper.appendChild(editButton);

          const deleteButton = document.createElement("button");
          deleteButton.type = "button";
          deleteButton.className = "action-btn delete";
          deleteButton.textContent = "Ø­Ø°Ù";
          deleteButton.addEventListener("click", () => deleteClient(client));
          actionsWrapper.appendChild(deleteButton);

          actionsCell.appendChild(actionsWrapper);
          tr.appendChild(actionsCell);

          clientsBody.appendChild(tr);
        }

      updateMetrics();
      renderTopClients();
    }

    function addClient(event){
      event.preventDefault();
      const name = document.getElementById("clientName").value.trim();
      if(!name) return;
      const noteValue = document.getElementById("clientNotes").value.trim();
      if(!accounts[name]){
        accounts[name] = [];
      }
      if(noteValue){
        clientNotesMap[name] = noteValue;
      } else if(clientNotesMap[name]){
        delete clientNotesMap[name];
      }
      localStorage.setItem("accounts", JSON.stringify(accounts));
      localStorage.setItem(clientNotesKey, JSON.stringify(clientNotesMap));
      event.target.reset();
      render();
    }

    function viewClient(name){
      window.location.href = "client.html?name=" + encodeURIComponent(name);
    }

    function editClient(oldName){
      const newName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ù…ÙŠÙ„:", oldName);
      if(newName && newName !== oldName){
        accounts[newName] = accounts[oldName];
        delete accounts[oldName];
        if(clientNotesMap[oldName]){
          clientNotesMap[newName] = clientNotesMap[oldName];
          delete clientNotesMap[oldName];
        }
        localStorage.setItem("accounts", JSON.stringify(accounts));
        localStorage.setItem(clientNotesKey, JSON.stringify(clientNotesMap));
        render();
      }
    }

    function deleteClient(name){
      if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ " + name + " ÙˆØ¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ØŸ")){
        delete accounts[name];
        if(clientNotesMap[name]){
          delete clientNotesMap[name];
          localStorage.setItem(clientNotesKey, JSON.stringify(clientNotesMap));
        }
        localStorage.setItem("accounts", JSON.stringify(accounts));
        render();
      }
    }

    function exportCSV(){
      const rows = [["Ø§Ù„Ø¹Ù…ÙŠÙ„","Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±","Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº (USD)","Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]];
      for(const client in accounts){
        const invoices = accounts[client];
        const total = invoices.reduce((sum, invoice) => sum + Number(invoice.price || 0), 0);
        const note = clientNotesMap[client] ? clientNotesMap[client].replace(/\n/g, " ") : "";
        rows.push([client, invoices.length, currencyFormatter.format(total), note]);
      }
      const csvContent = rows.map(row => row.join(",")).join("\n");
      const blob = new Blob([csvContent], { type:"text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = "accounts-report.csv";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    function totalAmountFor(client){
      return accounts[client].reduce((sum, invoice) => sum + Number(invoice.price || 0), 0);
    }

    function formatCurrency(value){
      const amount = Number(value || 0);
      return currencyFormatter.format(Number.isFinite(amount) ? amount : 0);
    }

    function updateMetrics(){
      const clientCount = Object.keys(accounts).length;
      let invoiceCount = 0;
      let totalAmount = 0;
      for(const client in accounts){
        const invoices = accounts[client];
        invoiceCount += invoices.length;
        totalAmount += invoices.reduce((sum, invoice) => sum + Number(invoice.price || 0), 0);
      }
      const average = invoiceCount ? totalAmount / invoiceCount : 0;
      document.getElementById("metricClients").textContent = numberFormatter.format(clientCount);
      document.getElementById("metricInvoices").textContent = numberFormatter.format(invoiceCount);
      document.getElementById("metricAmount").textContent = formatCurrency(totalAmount);
      document.getElementById("metricAverage").textContent = formatCurrency(average);
    }

    function renderTopClients(){
      const entries = Object.entries(accounts).map(([name, invoices]) => {
        return { name, total: invoices.reduce((sum, invoice) => sum + Number(invoice.price || 0), 0) };
      }).filter(item => item.total > 0);
      entries.sort((a,b) => b.total - a.total);
      topClientsList.innerHTML = "";
      if(entries.length === 0){
        const li = document.createElement("li");
        li.innerHTML = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯<span>--</span>";
        topClientsList.appendChild(li);
        return;
      }
      for(const item of entries.slice(0,5)){
        const li = document.createElement("li");
        li.innerHTML = `<strong>${item.name}</strong><span>${formatCurrency(item.total)}</span>`;
        topClientsList.appendChild(li);
      }
    }

    function notePreview(note){
      if(note.length <= 22) return note;
      return note.slice(0, 22) + "...";
    }

    render();
  </script>
</body>
</html>
