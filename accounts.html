<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ghadeer Logistics | إدارة العملاء</title>
  <link rel="stylesheet" href="assets/css/theme.css">
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <div class="brand-mark">GL</div>
      <h1>Ghadeer Logistics</h1>
    </div>
    <nav class="nav-links">
      <a class="nav-link" href="Home.html">الرئيسية</a>
      <a class="nav-link" href="about.html">عن الشركة</a>
      <a class="nav-link" href="dashboard.html">لوحة التحكم</a>
      <a class="nav-link active" href="accounts.html">الحسابات</a>
      <a class="nav-link" href="track.html">تتبع الشحنات</a>
      <a class="nav-link" href="Reportal.html">التقارير</a>
      <a class="nav-link" href="contact.html">اتصل بنا</a>
      <a class="nav-link" href="index.html">تسجيل الدخول</a>
    </nav>
  </header>

  <main class="page-shell">
    <section class="glass-card hero-card">
      <h2 class="page-title">إدارة عملاء Ghadeer</h2>
      <p class="lead">أضف عملاء جدد، راجع حساباتهم، وتابع فواتيرهم من مكان واحد مع مزامنة محلية تلقائية.</p>
      <div class="chip-row">
        <span class="chip">💾 تخزين محلي آمن</span>
        <span class="chip">🔍 بحث فوري</span>
        <span class="chip">📊 ملخصات مالية</span>
      </div>
    </section>

    <section class="glass-card table-card">
      <div class="table-header">
        <div class="section-heading">
          <div>
            <h2>سجل العملاء</h2>
            <p>أضف عميلًا جديدًا أو قم بالبحث داخل القائمة الحالية.</p>
          </div>
        </div>
        <div class="toolbar">
          <form id="clientForm" class="form-grid inline" onsubmit="addClient(event)">
            <div>
              <label for="clientName">اسم العميل</label>
              <input type="text" id="clientName" placeholder="مثال: شركة شمال كردستان" required>
            </div>
            <button class="button primary" type="submit">➕ إضافة عميل</button>
          </form>
          <div>
            <label for="search">بحث</label>
            <input type="text" id="search" placeholder="ابحث عن عميل..." oninput="render()">
          </div>
        </div>
      </div>

      <div class="table-scroll">
        <table class="data-table">
          <thead>
            <tr>
              <th>👤 العميل</th>
              <th>📑 عدد الفواتير</th>
              <th>💰 مجموع الحساب</th>
              <th>⚙️ خيارات</th>
            </tr>
          </thead>
          <tbody id="clients"></tbody>
        </table>
      </div>
    </section>

    <p class="footer-note">يتم حفظ البيانات في المتصفح لضمان سرعة الوصول وسهولة الإدارة.</p>
  </main>

  <script>
    let accounts = JSON.parse(localStorage.getItem('accounts')) || {};

    function render() {
      const tbody = document.getElementById('clients');
      tbody.innerHTML = '';
      const query = document.getElementById('search').value.trim();
      const normalizedQuery = query.toLowerCase();

      Object.keys(accounts).forEach((client) => {
        const normalizedClient = client.toLowerCase();
        if (normalizedQuery && !normalizedClient.includes(normalizedQuery)) {
          return;
        }

        const invoices = accounts[client];
        const total = invoices.reduce((sum, entry) => sum + Number(entry.price || 0), 0);
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${client}</td>
          <td>${invoices.length}</td>
          <td>${total.toLocaleString('en-US')}</td>
          <td>
            <div class="action-buttons">
              <button class="action-button view" onclick="viewClient('${client}')">👁️ عرض</button>
              <button class="action-button edit" onclick="editClient('${client}')">✏️ تعديل</button>
              <button class="action-button delete" onclick="deleteClient('${client}')">🗑️ حذف</button>
            </div>
          </td>`;
        tbody.appendChild(row);
      });
    }

    function addClient(event) {
      event.preventDefault();
      const nameField = document.getElementById('clientName');
      const name = nameField.value.trim();
      if (!name) {
        return;
      }
      if (!accounts[name]) {
        accounts[name] = [];
      }
      localStorage.setItem('accounts', JSON.stringify(accounts));
      render();
      event.target.reset();
      nameField.focus();
    }

    function viewClient(name) {
      window.location.href = 'client.html?name=' + encodeURIComponent(name);
    }

    function editClient(oldName) {
      const newName = prompt('أدخل الاسم الجديد للعميل:', oldName);
      if (newName && newName !== oldName) {
        accounts[newName] = accounts[oldName];
        delete accounts[oldName];
        localStorage.setItem('accounts', JSON.stringify(accounts));
        render();
      }
    }

    function deleteClient(name) {
      if (confirm('هل تريد حذف هذا العميل وجميع فواتيره؟')) {
        delete accounts[name];
        localStorage.setItem('accounts', JSON.stringify(accounts));
        render();
      }
    }

    render();
  </script>
</body>
</html>
